<!DOCTYPE html><html><head><meta charset="utf-8"/><link rel="shortcut icon" href="favicon.png"/><link rel="stylesheet" href="index.css"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="theme-color" content="#000000"/><title>Graffy</title><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/YReoqK_Er8BD_ieOT4qIG/pages/learn/03-pagination.js" as="script"/><link rel="preload" href="/_next/static/YReoqK_Er8BD_ieOT4qIG/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-035ac2b14bde147cb4a8.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.1f14ce44d930c2368bf0.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-7362d5fe4a1ff1ce8dc9.js" as="script"/></head><body class="jsx-2561753026"><div id="__next"><header class="jsx-2085888330">Graffy</header><div><h1>Pagination</h1><p>Let&#x27;s take a look at our blog example again.</p><pre><code class="language-js" metaString="">{
  posts: {
    1: { title: &#x27;Introduction&#x27;, … },
    2: { title: &#x27;Basics&#x27;, … },
    …
  }
}
</code></pre><p>It&#x27;s straightforward to get a post when you know its ID, but that&#x27;s pretty limiting. More realistically, we might want to fetch, say, 10 posts at a time. We can specify that in the query using an array.</p><h3>Slices</h3><pre><code class="language-js" metaString="">graffy.fetch({
  posts: [
    { first: 10 },
    {
      title: true,
      author: { name: true, avatar: true },
      date: true,
    },
  ],
});
</code></pre><p>See the <code>{ first: 10 }</code>? That tells Graffy which children of <code>posts</code> to include in the response. The second argument (<code>{ title, ... }</code>) is the sub-query to apply to each post (i.e. each grandchild of the <code>posts</code> node).</p><p>If you&#x27;re used the GraphQL, you can probably guess how slice works. The first argument to <code>slice()</code> can be:</p><ul><li><code>{ first: N }</code> or <code>{ last: N }</code> for the very first or last N children</li><li><code>{ first: N, after: key }</code>, <code>{ last: N, before: key }</code> for N children starting at the given key (post ID in this example)</li><li><code>{ after: firstKey, before: lastKey }</code> for all the children between the two keys; this could also have a <code>first</code> or <code>last</code> property to limit the result.</li></ul><p>Slices by themselves have a pretty serious limitation: they operate on keys, not on values. In this example, we got the first 10 posts ordered by <em>post ID</em>. This isn&#x27;t super useful.</p><p>More realistically, we might want the first 10 posts in January, ordered by date. That can&#x27;t be accomplished by <code>slice()</code> alone, you need an <em>index</em>.</p><h3>Indexes</h3><p>Indexes are a common Graffy pattern that uses links and slices to help queries order, filter and paginate over data in different ways.</p><p>For example, to query posts based on their date, we might define an index that links dates to the posts:</p><pre><code class="language-js" metaString="">// Data
{
  posts: {
    1: { …, date: &#x27;2019-03-02&#x27; },
    2: { …, date: &#x27;2019-03-04&#x27; }
  },
  // This is the index
  postsByDate: {
    [key(&#x27;2019-03-02&#x27;, 1)]: link(&#x27;/posts/1&#x27;),
    [key(&#x27;2019-03-04&#x27;, 2)]: link(&#x27;/posts/2&#x27;),
  }
}
</code></pre><p>Index keys must be unique; as two posts may have the same date, we append the ID to index keys to ensure uniqueness. We also use the <code>key()</code> helper to specify keys that contain multiple values and types other than strings.</p><blockquote><p><strong>Note</strong>: The order matters! Keys are sorted by the first value, and subsequent values are only used to break ties.</p></blockquote><pre><code class="language-js" metaString="">// Query: First 10 posts created in January
{
  postsByDate: slice(
    { after: &#x27;2019-01-01&#x27;, before: &#x27;2019-01-31&#x27;, first: 10 },
    {
      title: true,
      author: { name: true, avatar: true },
      date: true,
    },
  );
}
</code></pre><h3>Next</h3><p>Representing changes.</p></div></div><script id="__NEXT_DATA__" type="application/json">{"dataManager":"[]","props":{"pageProps":{}},"page":"/learn/03-pagination","query":{},"buildId":"YReoqK_Er8BD_ieOT4qIG","nextExport":true,"autoExport":true}</script><script async="" data-next-page="/learn/03-pagination" src="/_next/static/YReoqK_Er8BD_ieOT4qIG/pages/learn/03-pagination.js"></script><script async="" data-next-page="/_app" src="/_next/static/YReoqK_Er8BD_ieOT4qIG/pages/_app.js"></script><script src="/_next/static/runtime/webpack-035ac2b14bde147cb4a8.js" async=""></script><script src="/_next/static/chunks/commons.1f14ce44d930c2368bf0.js" async=""></script><script src="/_next/static/runtime/main-7362d5fe4a1ff1ce8dc9.js" async=""></script></body></html>