<!DOCTYPE html><html><head><meta charset="utf-8"/><link rel="shortcut icon" href="favicon.png"/><link rel="stylesheet" href="index.css"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="theme-color" content="#000000"/><title>Graffy</title><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/YReoqK_Er8BD_ieOT4qIG/pages/learn/02-basics.js" as="script"/><link rel="preload" href="/_next/static/YReoqK_Er8BD_ieOT4qIG/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-035ac2b14bde147cb4a8.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.1f14ce44d930c2368bf0.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-7362d5fe4a1ff1ce8dc9.js" as="script"/></head><body class="jsx-2561753026"><div id="__next"><header class="jsx-2085888330">Graffy</header><div><h1>Basic usage</h1><p>Graffy uses just a few simple yet powerful concepts:</p><h3>Data model</h3><p>All the data in your backend is <em>modeled</em> like a single giant JSON tree. In addition to normal JSON values like strings and numbers, leaf nodes in Graffy may contain <strong>links</strong> to other parts of the tree. These work just like symlinks in a file system. If you&#x27;ve used Falcor, all this should sound pretty familiar - it&#x27;s JSON Graph.</p><p>Here&#x27;s an example JSON graph for a toy blog with some <code>users</code> and some <code>posts</code>:</p><pre><code class="language-js" metaString="">{
  users: {
    1: { name: &#x27;Alice&#x27;, avatar: &#x27;ðŸ‘§&#x27;, â€¦ },
    2: { name: &#x27;Bob&#x27;, avatar: &#x27;ðŸ‘¨&#x27;, â€¦ },
    â€¦
  },
  posts: {
    1: { author: link(&#x27;/users/2&#x27;), â€¦ },
    2: { author: link(&#x27;/users/1&#x27;), â€¦ },
    â€¦
  }
}
</code></pre><p>The <code>author</code> property on each post is a link to the corresponding user. <code>link()</code> is a helper that creates a link object.</p><blockquote><p><strong>Note</strong>: The Graffy data model isn&#x27;t exactly JSON. Keys (property names) don&#x27;t have to be strings, they can be any data type. Arrays come with many caveats and generally can&#x27;t be used except as leaf nodes. (This is why <code>users</code> and <code>posts</code> are objects, not arrays.) <code>null</code> has special meaning (a value known to not exist) and can&#x27;t be used to represent anything else.</p></blockquote><h3>Queries</h3><p>Graffy queries specify all the nodes (down to leaf nodes) they want to fetch, in a tree that mirrors the expected result. This works just like GraphQL:</p><pre><code class="language-js" metaString="">// Query
store.fetch({ posts: { 1: { author: { name: true, avatar: true } } } });

// Result
{ posts: { 1: { author: { name: &#x27;Bob&#x27;, avatar: &#x27;ðŸ‘¨&#x27; } } } }
</code></pre><p>You might have noticed that the query went right through a symlink. This allows Graffy to return multiple nested resources in a single query.</p><h3>API</h3><p>The API is fairly straightforward and familiar.</p><p>Graffy is highly modular, and uses plugins and middleware like Express or Koa Node.js frameworks. Clients typically use graffy-cache to provide in-memory caching and graffy-client, while servers would swap out graffy-client for graffy-server. Setting up a store is straightforward:</p><pre><code class="language-js" metaString="">import Graffy from &#x27;@graffy/core&#x27;;
import GraffyCache from &#x27;@graffy/cache&#x27;;
import GraffyClient from &#x27;@graffy/client&#x27;;

const store = new Graffy();
store.use(GraffyCache());
store.use(GraffyClient(&#x27;https://example.com/api&#x27;));
</code></pre><h4>&quot;Outer&quot; APIs</h4><ul><li><code>store.fetch(query)</code> for one-time queries</li><li><code>store.watch(query)</code> for live queries</li><li><code>store.patch(graph)</code> for writes</li></ul><p>Fetch and patch return promises, while watch returns async iterables.</p><pre><code class="language-js" metaString="">const result = await store.fetch(query);

await store.patch(changes); // Wait till complete.

for await (const result of store.watch(query)) {
  /* Each iteration has an updated value of result. */
}
</code></pre><h4>&quot;Inner&quot; APIs</h4><ul><li><code>store.onFetch(path, handler)</code></li><li><code>store.onWatch(path, handler)</code></li><li><code>store.onPatch(path, handler)</code></li></ul><p>These handlers connect the store to your custom backend databases. Naturally, onFetch and onPatch handlers should return promises and onWatch handlers should return async iterables.</p><pre><code class="language-js" metaString="">store.onFetch(&#x27;/users&#x27;, query =&gt; {
  const ids = Object.keys(query);
  return db.collection(&#x27;users&#x27;).findAll(ids);
});

store.onWatch(&#x27;/posts&#x27;, query =&gt; {
  const ids = Object.keys(query);

  // makeAsyncIterable is a helper
  return makeAsyncIterable(push =&gt; {
    const stream = bus.on(&#x27;posts&#x27;, post =&gt; {
      if (ids.includes(post.id)) push(post);
    });
    return () =&gt; stream.close();
  });
});
</code></pre><p>The store has two more backend APIs, <code>on()</code> and <code>use()</code>. These will be covered in more detail later.</p><h3>Next</h3><p>Pagination: Ordering and filtering data in queries, constructing indexes.</p></div></div><script id="__NEXT_DATA__" type="application/json">{"dataManager":"[]","props":{"pageProps":{}},"page":"/learn/02-basics","query":{},"buildId":"YReoqK_Er8BD_ieOT4qIG","nextExport":true,"autoExport":true}</script><script async="" data-next-page="/learn/02-basics" src="/_next/static/YReoqK_Er8BD_ieOT4qIG/pages/learn/02-basics.js"></script><script async="" data-next-page="/_app" src="/_next/static/YReoqK_Er8BD_ieOT4qIG/pages/_app.js"></script><script src="/_next/static/runtime/webpack-035ac2b14bde147cb4a8.js" async=""></script><script src="/_next/static/chunks/commons.1f14ce44d930c2368bf0.js" async=""></script><script src="/_next/static/runtime/main-7362d5fe4a1ff1ce8dc9.js" async=""></script></body></html>